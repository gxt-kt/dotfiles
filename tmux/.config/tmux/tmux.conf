# By gxt_kt

# After change ~/.config/tmux/tmux.conf, It's best to kill tmux and restart it to make the change take effect.
# $tmux kill-server && tmux || tmux

# If you cannot start tmux, use following cmd to kill tmux completely and then restart tmux
# $pkill -9 tmux

# If first use this config. It's necessary to download tmp manually.
# if you use my whole dotfiles with tmux, the tpm is exist and no need to download again.
# https://github.com/tmux-plugins/tpm

set -g mouse on

# add for support image show in tmux
set -gq allow-passthrough on
set -g visual-activity off

# Notice that whatever config the color:
# Please make sure three points:
# 1.You can use Italic font
# 2.Background color and highlight show find. Compare to use alacritty without tmux.
# 3.You can use home and end. If you cannot but the aboves are normal, you can remap home and end below.
set -g default-terminal "screen-256color"
set-option -g default-terminal "tmux-256color" 
set -ga terminal-overrides ",xterm-256color:Tc"
set -as terminal-overrides ',xterm*:sitm=\E[3m'

# Becase set the 256color. Cause home and end cannot use. Please remap them.
# bind-key -n Home send Escape "OH"
# bind-key -n End send Escape "OF"

# Share clipboard with system
set-option -s set-clipboard on
set-window-option -g mode-keys vi 

#ğŸ”½ğŸ”½ğŸ”½
# TMUX color config
# tmux color https://i.stack.imgur.com/e63et.png
set -g mode-style "fg=default,bg=default,reverse"
set -g status-bg color147
set -g status-fg white
set -g pane-border-style fg=default      
set -ga pane-border-style bg=color147
set -g pane-active-border-style fg=black
set -ga pane-active-border-style bg=yellow
setw -g window-status-style fg=black
setw -g window-status-current-style fg=color160
setw -g window-status-activity-style fg=white
setw -g window-status-bell-style fg=white
set -g message-style bg=black,fg=orange
#ğŸ”¼ğŸ”¼ğŸ”¼


# reload the $HOME/.config/tmux/tmux.conf file with Ctrl-r
bind C-r source-file ~/.config/tmux/tmux.conf \; display-message "configuration reloaded"

# set the prefix
# unbind C-b
# set -g prefix C-a

# set pane title
# bind-key . command-prompt "select-pane -T '%%'"
# set -g pane-border-status top
# set -g pane-border-format " [ ###P #T ] "

# select pane
bind -n C-k select-pane -U
bind -n C-j select-pane -D
bind -n C-h select-pane -L
bind -n C-l select-pane -R

# select pane
bind-key k select-pane -U
bind-key j select-pane -D
bind-key h select-pane -L
bind-key l select-pane -R

# copy-mode
bind-key y copy-mode    # enter copy mode
# bind p paste-buffer     # paste content
bind -T copy-mode-vi "v" send -X begin-selection
bind -T copy-mode-vi "V" send -X rectangle-toggle
bind -T copy-mode-vi "y" send -X copy-selection-and-cancel


# vertical split (prefix -)
# unbind '"'
bind '-' split-window -v -c "#{pane_current_path}"
# horizontal split (prefix |)
# unbind %
bind '\' split-window -h -c "#{pane_current_path}"

# move window
bind-key ',' swap-pane -U
bind-key '.' swap-pane -D

# rename window
bind-key 'r' command-prompt -p "Rename window:" "rename-window '%%'"

# set Alt+num goto window num
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# kill pane
unbind q 
bind-key q kill-pane

# kill window
unbind Q 
bind-key Q confirm kill-window

# size windows based on clients looking at that window
setw -g aggressive-resize on

# resize pane
bind-key -n C-Left  "resize-pane -L 5"
bind-key -n C-Right "resize-pane -R 5"
bind-key -n C-Up    "resize-pane -U 5"
bind-key -n C-Down  "resize-pane -D 5"

# use keymap with vim
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' { if -F '#{pane_at_left}' '' 'select-pane -L' }
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' { if -F '#{pane_at_bottom}' '' 'select-pane -D' }
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' { if -F '#{pane_at_top}' '' 'select-pane -U' }
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' { if -F '#{pane_at_right}' '' 'select-pane -R' }
bind-key -T copy-mode-vi 'C-h' if -F '#{pane_at_left}' '' 'select-pane -L'
bind-key -T copy-mode-vi 'C-j' if -F '#{pane_at_bottom}' '' 'select-pane -D'
bind-key -T copy-mode-vi 'C-k' if -F '#{pane_at_top}' '' 'select-pane -U'
bind-key -T copy-mode-vi 'C-l' if -F '#{pane_at_right}' '' 'select-pane -R'

# start window numbers at 1 to match keyboard order with tmux order
set -g base-index 1
# start pane numbers at 1 to match keyboard order with tmux order
setw -g pane-base-index 1
# renumber windows sequentially after closing any of them
set -g renumber-windows on
# monitor windows for activity
setw -g monitor-activity on
# don't wait for escape sequences
set -sg escape-time 0
# display pane numbers for longer
set -g display-panes-time 2000
# increase scrollback lines
set -g history-limit 65536

# prefix+@ breaks current pane into separate window
# join a pane/window from the current session into the current window
bind @ command-prompt -p "create pane from:" "join-pane -s ':%%'"

#ğŸ”½ğŸ”½ğŸ”½
# set status bar
set -g status-interval 2 # çŠ¶æ€æ åˆ·æ–°æ—¶é—´
set -g status-justify left # çŠ¶æ€æ åˆ—è¡¨å·¦å¯¹é½ left/centre/right
setw -g monitor-activity on # éå½“å‰çª—å£æœ‰å†…å®¹æ›´æ–°æ—¶åœ¨çŠ¶æ€æ é€šçŸ¥
set-option -g status-left ''
# set-option -g status-right '#(echo "123")'
# $(echo $(( `cat /sys/class/thermal/thermal_zone0/temp` / 1000)))
# î#(echo $(( `cat /sys/class/thermal/thermal_zone0/temp` / 1000))îŒ¹) 
set -g status-right '#[bg=yellow]#[fg=black] #{battery_status_bg}#{battery_icon_status}#{battery_percentage} \
#{cpu_bg_color}#[fg=black] #{cpu_icon}#{cpu_percentage} \
#[bg=pink] %a %h-%d %H:%M '
#ğŸ”¼ğŸ”¼ğŸ”¼


#ğŸ”½ğŸ”½ğŸ”½
# set tpm plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'

set -g @plugin 'tmux-plugins/tmux-open' 
set -g @plugin 'trevarj/tmux-open-nvim'
set -g @open 'C-o'
set -g @open-editor 'o'
set -g @open-O 'https://www.google.com/search?q='


# prefix+C-s save prefix+C-r reload
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-capture-pane-contents 'on'
# é»˜è®¤æ¢å¤ @resurrect-default-processes="vi vim nvim emacs man less more tail top htop irssi weechat mutt"
set -g @resurrect-processes "ssh btop ranger yazi lazygit gitui fzf"
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'off' # last saved environment is automatically restored when tmux is started.
set -g @continuum-boot 'off'    # automatic tmux start

# tmux file tree
set -g @plugin 'tmux-plugins/tmux-sidebar'
set -g @sidebar-tree 'e'

set -g @plugin 'laktak/extrakto'
set -g @extrakto_copy_key "tab"      # use tab to copy to clipboard
set -g @extrakto_insert_key "enter"  # use enter to insert selection
set -g @extrakto_fzf_unset_default_opts "false"  # keep our custom FZF_DEFAULT_OPTS

set -g @plugin 'Morantron/tmux-fingers'

# set -g @plugin 'tmux-plugins/tmux-yank'
# set -g @plugin 'CrispyConductor/tmux-copy-toolkit'
# set -g @copytk-copy-command "xclip -selection c"
# set -g @copytk-copy-command "tmux load-buffer -; tmux save-buffer - | xclip -selection c"
# set -g @copytk-no-default-matches off




set -wg window-status-format "#I:#W " # çŠ¶æ€æ çª—å£åç§°æ ¼å¼
set -wg window-status-current-format "#I:#W#F " # çŠ¶æ€æ å½“å‰çª—å£åç§°æ ¼å¼(#Iï¼šåºå·ï¼Œ#wï¼šçª—å£åç§°ï¼Œ#Fï¼šé—´éš”ç¬¦)
set -wg window-status-separator "" # çŠ¶æ€æ çª—å£åç§°ä¹‹é—´çš„é—´éš”

set -g @cpu_low_icon "î«²" #ï’ icon when cpu is low
set -g @cpu_medium_icon "î«²" # icon when cpu is medium
set -g @cpu_high_icon "î«²" # icon when cpu is high
set -g @cpu_percentage_format "%2.0f%%"
set -g @cpu_low_bg_color "#[bg=green]" # background color when cpu is low
set -g @cpu_medium_bg_color "#[bg=orange]" # background color when cpu is medium
set -g @cpu_high_bg_color "#[bg=red]" # background color when cpu is high

# run-shell ~/.config/tmux/plugins/tmux-cpu/cpu.tmux
# run-shell ~/.config/tmux/plugins/tmux-battery/battery.tmux

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
# run '~/.tmux/plugins/tpm/tpm'
run '~/.config/tmux/plugins/tpm/tpm'
#ğŸ”¼ğŸ”¼ğŸ”¼
